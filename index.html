<!--
 API Documentation HTML Template  - 1.0.1
 Copyright © 2016 Florian Nicolas
 Licensed under the MIT license.
 https://github.com/ticlekiwi/API-Documentation-HTML-Template
 !-->
<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    <title>Tapsi Pack API doc</title>
    <meta name="description" content="">
    <meta name="author" content="tapsi-pack">
    <meta http-equiv="cleartype" content="on">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="css/hightlightjs-dark.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;1,300&family=Source+Code+Pro:wght@300&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="css/style.css" media="all">
    <link rel="shortcut icon" href="images/favicon.ico" title="Favicon"/>
    <script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
<div class="left-menu">
    <div class="content-logo">
        <div class="logo">
            <img alt="Tapsi Pack"
                 title="Tapsi Pack Logo" src="images/logo.png" height="32"/>
            <span>API Documentation</span>
        </div>
        <button class="burger-menu-icon" id="button-menu-mobile">
            <svg width="34" height="34" viewBox="0 0 100 100">
                <path class="line line1"
                      d="M 20,29.000046 H 80.000231 C 80.000231,29.000046 94.498839,28.817352 94.532987,66.711331 94.543142,77.980673 90.966081,81.670246 85.259173,81.668997 79.552261,81.667751 75.000211,74.999942 75.000211,74.999942 L 25.000021,25.000058"></path>
                <path class="line line2" d="M 20,50 H 80"></path>
                <path class="line line3"
                      d="M 20,70.999954 H 80.000231 C 80.000231,70.999954 94.498839,71.182648 94.532987,33.288669 94.543142,22.019327 90.966081,18.329754 85.259173,18.331003 79.552261,18.332249 75.000211,25.000058 75.000211,25.000058 L 25.000021,74.999942"></path>
            </svg>
        </button>
    </div>
    <div class="mobile-menu-closer"></div>
    <div class="content-menu">
        <div class="content-infos">
            <div class="info"><b>Version:</b> 1.0.0</div>
            <div class="info"><b>Last Updated:</b> 10th Oct, 2023</div>
        </div>
        <ul>
            <li class="scroll-to-link active" data-target="content-get-started">
                <a>Get Started</a>
            </li>
            <li class="scroll-to-link" data-target="content-token-management">
                <a>Token Management for Clients</a>
            </li>
            <li class="scroll-to-link" data-target="content-errors">
                <a>Error Models</a>
            </li>

            <li class="scroll-to-link" data-target="content-client-apis">
                <a>Client APIs</a>
            </li>

            <li class="scroll-to-link" data-target="content-available-dates">
                <a> - Available Dates API</a>
            </li>
            <li class="scroll-to-link" data-target="content-order-preview">
                <a> - Order Preview API</a>
            </li>
            <li class="scroll-to-link" data-target="content-order-submission">
                <a> - Order Submission API</a>
            </li>
            <li class="scroll-to-link" data-target="content-get-order">
                <a> - Get Order API</a>
            </li>
        </ul>
    </div>
</div>
<div class="content-page">
    <div class="content-code"></div>
    <div class="content">
        <div class="overflow-hidden content-section" id="content-get-started">
            <h1>Get started</h1>
            <pre>
    API Endpoint

        https://api.tapsi.cab/
                </pre>
            <p>
                <strong>Tapsi-Pack</strong> offers a set of embedded APIs for external teams to integrate <strong>Tapsi-Pack</strong>
                functionalities into their own applications.
                These external teams are called <strong>clients</strong> in this document, and each client is
                assigned a unique <strong>client_id</strong> and a corresponding <strong>client_secret</strong>.
            </p>

            <p>

                To access external APIs, a token must be provided in the header of clients' request. This token ensures
                secure access to the APIs and prevents unauthorized access to sensitive data. With these APIs, clients
                can easily incorporate <strong>Tapsi-Pack</strong>'s features into their own products, enhancing their
                functionality and
                user experience.
            </p>

            <p>

                The token should be set in the header with the key name <strong>"authorization"</strong>.
            </p>
            <p>
                There are two types of tokens:
            </p>
            <ul>
                <li>
                    Client Secret Token
                </li>

                <li>
                    User Access Token
                </li>
            </ul>

            <p>
                To get your token, please contact us at
                <a href="https://pack.tapsi.ir/landing">Tapsi Pack</a>
                to get your own tokens.
            </p>
        </div>

        <div class="overflow-hidden content-section" id="content-token-management">
            <h1>Token Management for Clients</h1>

            <div>
                <h3>
                    1. Generate Access Token and Refresh Token using Client ID and PAT
                </h3>
                <pre>
                <code class="bash">
# Here is a curl example
curl --location 'https://api.tapsi.cab/api/v1/delivery/external/oauth2/token' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--header 'Authorization: Bearer Client Secret' \
--data-urlencode 'grant_type=authorization_code' \
--data-urlencode 'code=User PAT'

                </code>
            </pre>
                <p>
                    Each client is assigned a Client ID, known as the <strong>"Client ID"</strong>.
                    Clients have the ability to generate both an
                    <strong>Access Token</strong> and a <strong>Refresh Token</strong>
                    using their <strong>Client ID</strong> in combination with the <strong>user's PAT</strong>.
                    The Access Token that is generated inherits the permissions associated with the corresponding PAT.
                    The body of the message should be sent as <strong>x-www-form-urlencoded</strong>
                    and the provided <strong>client secret</strong> should be set as the <strong>Bearer</strong>
                    authorization header.
                </p>
                <p>
                    The client can utilize the Pack APIs by using the <strong>access token</strong>.
                    The available APIs are described in the Client APIs part of this document.
                    The <strong>access token</strong> should be placed in the request header using the <strong>`authorization`</strong>
                    key.
                </p>
                <p>
                    URL :<br>
                    <code class="higlighted break-word">/api/v1/delivery/external/oauth2/token</code>
                </p>
                <p>
                    METHOD :<br>
                    <code class="higlighted break-word">POST</code>
                </p>
                <br>
                <pre><code class="json">
# Response:

{
    "access_token": String,
    "refresh_token": String,
    "scope": String,
    "token_type": "Bearer",
    "expires_in": Int // seconds to expiration
}
                </code>
            </pre>
                <h4>Form URL Encoded</h4>
                <table class="central-overflow-x">
                    <thead>
                    <tr>
                        <th>Field</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>grant_type</td>
                        <td>String</td>
                        <td>authorization_code</td>
                    </tr>
                    <tr>
                        <td>code</td>
                        <td>String</td>
                        <td>User PAT</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div>
                <h3>
                    2. Access Token Expiry
                </h3>
                <pre>
                <code class="bash">
HTTP/1.1 401 Unauthorized
Content-Type: text

Jwt is expired

                </code>
            </pre>
                <p>
                    Clients are allowed to utilize the access token until it reaches its expiration point.
                    Should a client attempt to use an access token that has already expired,
                    the following response will be
                    generated
                </p>
                <br>
                <pre><code class="json">
                </code>
            </pre>
            </div>

            <div>
                <h3>
                    3. Generate a new Access Token and Refresh token using the Refresh token
                </h3>
                <pre>
                <code class="bash">
# Here is a curl example
curl --location 'https://api.tapsi.cab/api/v1/delivery/external/oauth2/token' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--header 'Authorization: Bearer Client Secret' \
--data-urlencode 'grant_type=refresh_token' \
--data-urlencode 'refresh_token=User Refresh Token'

                </code>
            </pre>
                <p>
                    Once a client has obtained an initial Access Token and Refresh Token, they can use the Refresh Token
                    to generate a new Access Token and Refresh Token without needing to involve the user's PAT or Client
                    ID again. This is useful for maintaining continuous access to the API without frequent user
                    interactions.
                    To generate a new set of tokens using a Refresh Token, clients should make a POST request to the
                    token endpoint, and the body of the message should be sent as
                    <strong>x-www-form-urlencoded</strong> and the client
                    secret as the <strong>Bearer</strong> authorization header.
                </p>

                <p>
                    At present, the access token is configured to remain valid for a duration of 2 days. When it
                    expires, users need to log in using their Personal Access Token (PAT) again, following the same
                    process as in Step 1.
                </p>
                <br>
                <pre><code class="json">
# Success Response:

{
    "access_token": String,
    "refresh_token": String,k
    "scope": String,
    "token_type": "Bearer",
    "expires_in": Int // seconds to expiration
}


# Error Response:

HTTP/1.1 401 Unauthorized
Content-Type: text

Jwt is expired
                </code>
            </pre>
                <h4>Form URL Encoded</h4>
                <table class="central-overflow-x">
                    <thead>
                    <tr>
                        <th>Field</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>grant_type</td>
                        <td>String</td>
                        <td>refresh_token</td>
                    </tr>
                    <tr>
                        <td>refresh_token</td>
                        <td>String</td>
                        <td>User Refresh Token</td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </div>

        <div class="overflow-hidden content-section" id="content-errors">
            <h1>Error Models</h1>
            <pre>
                <code class="json">
{
code: Int, //A simple error code that can be easily handled by the client.
message: String,
details: Error[]
}
                </code>
            </pre>
            <p>
                This document provides an overview of the Tapsi-Pack error model for Istio APIs,
                which uses
                <a href="https://cloud.google.com/apis/design/errors">Google Error Model APIs</a>
                as the underlying infrastructure.
                Every error that occurs within handling a request in Tapsi-Pack that is called has the following format:
            </p>

            <h3>
                Error Message
            </h3>

            <p>
                The error message should assist users in comprehending and resolving the API error quickly and easily.
                The message field is intended for developers and is written in English.
            </p>

            <h3>
                Error Details
            </h3>

            <p>
                There are some standard error payloads for error details. These cover the most common needs for API
                errors. Like error codes, developers should use these standard payloads whenever possible. For now, in
                Tapsi-Pack we have one known payload:
            </p>

            <table class="central-overflow-x">
                <thead>
                <tr>
                    <th>Field</th>
                    <th>Type</th>
                    <th>Description</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>ErrorLocalization</td>
                    <td>String</td>
                    <td>
                        If a user-facing error message is needed. we use this error payload, in which the message in
                        this payload is localized.
                    </td>
                </tr>
                </tbody>
            </table>

            <h4>
                Error Localization
            </h4>
            <pre>
                <code class="json">
# Error Localized Message:

{
  "@type": "type.googleapis.com/google.rpc.LocalizedMessage",
  "locale": "fa-IR",
  "message": "مختصات داده شده اشتباه است یا تپسی پک در این مختصات سرویس ارائه نمی‌دهد."
}
                </code>
            </pre>
            <p>
                If a user-facing error message is needed, use LocalizedMessage which will be appeared in the details
                field.
            </p>


            <h4>
                Constraints of Error Details
            </h4>
            <p>
                The Tapsi-Pack backend team guarantees that the error details will always be one of the standard error
                payloads. However, the backend team does not guarantee that the error details will always be present.
                For example, if the error is caused by a network failure, the error details may not be available. In
                this case, the client should not rely on the error details to be present. Instead, the client should
                rely on the error code and message to be present. The client should also be prepared to handle the case
                where the error details are not present.
            </p>
            <p>
                Also, The Tapsi-Pack backend team guarantees that the list of error details always contains one or zero
                of each unique type and there are rules for handling them:
                If there are any ErrorLocalization, the message in this object should be shown to the end user.

            </p>
        </div>

        <div class="overflow-hidden content-section" id="content-client-apis">
            <h1>Client APIs</h1>
            <p>
                These APIs can be used by clients. The access token should be set in the header of all APIs with the key
                name "authorization".
            </p>

            <div id="content-available-dates">
                <h3>
                    Available Dates API
                </h3>
                <pre>
                    <code class="json">
# Response:

{
 "availableDatesTimestamp": [
  "1690576200000",
  "1690662600000",
  "1690749000000"
 ]
}
                </code>
            </pre>
                <p>
                    This API returns a list of timestamps that correspond to the first days in which Tapsi Pack can
                    offer services in the Tehran timezone. These timestamps are used in the preview API to calculate
                    time-slots for a specific day.
                    This API can be called with both client secret and user access token.
                </p>
                <p>
                    URL :<br>
                    <code class="higlighted break-word">/api/v1/delivery/external/embedded/available-dates</code>
                </p>
                <p>
                    METHOD :<br>
                    <code class="higlighted break-word">GET</code>
                </p>
            </div>


            <div id="content-order-preview">
                <h3>
                    Order Preview API
                </h3>
                <pre>
                <code class="json">

# Response:

{
  "token": "string",
  "invoicePerTimeslots": [
    {
      "timeslotId": "string",
      "startTimestamp": "Long", // start timestamp of the timeslot
      "endTimestamp": "Long", // end timestamp of the timeslot
      "isAvailable": "bool", // indicate if the timeslot is available or not
      "invoice": "Invoice?" // It's null when the timeslot is not available
    }
  ]
}

Invoice: {
  "discount": "int", // the amount of discount
  "amount": "int", // the total amount of the order
  "paymentInAdvance": "int", // the payment in advance amount (amount - discount - senderCredit)
  "descriptions": [ // the detail of the invoice provided as a list of title and description
    {
      "title": "string", // description title according to the user language
      "amount": "int"
    }
  ]
}
                </code>
            </pre>
                <p>
                    Clients are allowed to utilize the access token until it reaches its expiration point.
                    Should a client attempt to use an access token that has already expired,
                    the following response will be
                    generated
                </p>
                <p>
                    Also, if this API is called using the client secret instead of the user access token, you can
                    display a preview of prices to your users without the need for a user token. The only difference is
                    that the Token field in the response of this API will be an empty string.
                </p>

                <p>
                    URL :<br>
                    <code class="higlighted break-word">/api/v1/delivery/external/embedded/order/preview</code>
                </p>
                <p>
                    METHOD :<br>
                    <code class="higlighted break-word">GET</code>
                </p>

                <h4>Query Params</h4>
                <table class="central-overflow-x">
                    <thead>
                    <tr>
                        <th>Field</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>originLat</td>
                        <td>float</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>originLong</td>
                        <td>float</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>destinationLat</td>
                        <td>float</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>destinationLong</td>
                        <td>float</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>dateTimestamp</td>
                        <td>float</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>couponCode</td>
                        <td>string?</td>
                        <td>(optional)</td>
                    </tr>
                    </tbody>
                </table>

            </div>


            <div id="content-order-submission">
                <h3>
                    Order Submission API
                </h3>
                <pre>
                <code class="json">

# Location:

{
  "coordinate": {
    "longitude": float,
    "latitude": float
  },
  "description": "string",
  "buildingNumber": "string",
  "apartmentNumber": "string"
}

# Phone:

{
  "number": "string",
  "type": "string" // HOME, MOBILE, OTHER
}

# Receiver:

{
  "fullName": "string",
  "phones": [Phone],
  "location": Location
}

# Sender:

{
  "location": Location
}

# Pack:

{
  "description": "string"
}

# Response:

{
  "orderId": "string" // the submitted order identifier
}
                </code>
            </pre>
                <p>
                    Clients are allowed to utilize the access token until it reaches its expiration point.
                    Should a client attempt to use an access token that has already expired,
                    the following response will be
                    generated
                </p>
                <p>
                    Also, if this API is called using the client secret instead of the user access token, you can
                    display a preview of prices to your users without the need for a user token. The only difference is
                    that the Token field in the response of this API will be an empty string.
                </p>

                <p>
                    URL :<br>
                    <code class="higlighted break-word">/api/v1/delivery/external/embedded/order/submit</code>
                </p>
                <p>
                    METHOD :<br>
                    <code class="higlighted break-word">POST</code>
                </p>

                <h4>Request Body</h4>
                <table class="central-overflow-x">
                    <thead>
                    <tr>
                        <th>Field</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>sender</td>
                        <td>Sender</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>receiver</td>
                        <td>Receiver</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>pack</td>
                        <td>Pack</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>timeslotId</td>
                        <td>string</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>token</td>
                        <td>string</td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>

            </div>

            <div id="content-get-order">
                <h3>
                    Get Order API
                </h3>
                <br>
                <pre>
                <code class="json">
# Response:

{
 "order": {
  "origin": {
   "coordinate": {
    "latitude": 35.630649566650391,
    "longitude": 51.364894866943359
   },
   "description": "تهران، بل شکوفه، خ. سبلان",
   "buildingNumber": "۱۶۱",
   "apartmentNumber": ""
  },
  "receiver": {
   "location": {
    "coordinate": {
     "latitude": 35.631649017333984,
     "longitude": 51.363895416259766
    },
    "description": "بلوار شکوفه، سبلان",
    "buildingNumber": "3",
    "apartmentNumber": ""
   },
   "fullName": "محمد محمدی",
   "phoneNumber": "09121111111",
   "phones": [
    {
     "number": "09121111111",
     "type": "MOBILE",
     "isPrimary": true,
     "title": "شماره همراه"
    }
   ]
  },
  "package": {
   "description": ""
  },
  "timeslot": {
   "startTimestamp": "1697121000000",
   "endTimestamp": "1697131800000",
   "id": "1697121000000_1697131800000"
  },
  "createdAt": "1697037952899",
  "orderCode": "PACK-680212",
  "orderId": "65r12ea7db",
  "price": {
   "price": "14500",
   "passengerShare": "14500"
  },
  "statusInfo": {
   "status": "CANCELLED_BY_SENDER",
   "title": "لغو شده توسط فرستنده",
   "description": "سفارش توسط فرستنده لغو شد.\nدر صورت نیاز، می\u200cتوانید با پشتیبانی تپسی\u200cپک به شماره ۱۶۳۰ تماس بگیرید."
  },
  "cancelable": false,
  "rating": {},
  "sender": {
   "id": "54759226",
   "profile": {
    "firstName": "رضا",
    "lastName": "رضایی",
    "phoneNumber": "+989301234567",
    "name": "رضا رضایی",
    "phones": [
     {
      "number": "+989301234567",
      "type": "MOBILE",
      "isPrimary": true,
      "title": "شماره همراه"
     }
    ]
   },
   "location": {
    "coordinate": {
     "latitude": 35.630649566650391,
     "longitude": 51.364894866943359
    },
    "description": "تهران، بل شکوفه، خ. سبلان",
    "buildingNumber": "۱۶۱",
    "apartmentNumber": ""
   }
  },
  "proofOfDelivery": {
   "required": true,
   "code": "9600"
  },
  "nonTaker": {
   "type": "RECEIVER",
   "phones": [
    {
     "number": "09121111111",
     "type": "MOBILE",
     "isPrimary": true,
     "title": "شماره همراه"
    }
   ],
   "locations": [
    {
     "location": {
      "coordinate": {
       "latitude": 35.631649017333984,
       "longitude": 51.363895416259766
      },
      "description": "بلوار شکوفه، سبلان",
      "buildingNumber": "3",
      "apartmentNumber": ""
     }
    }
   ],
   "name": "محمد محمدی"
  }
 }
}


                </code>

            </pre>
                <p>
                    Clients can select an order by the ID of the order.
                </p>

                <p>
                    URL :<br>
                    <code class="higlighted break-word">/api/v1/delivery/external/embedded/order/{order_id}</code>
                </p>
                <p>
                    METHOD :<br>
                    <code class="higlighted break-word">GET</code>
                </p>

                <h4>Parameters:</h4>
                <table class="central-overflow-x">
                    <thead>
                    <tr>
                        <th>Field</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>order_id</td>
                        <td>string</td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>

            </div>
        </div>

    </div>
</div>
<div class="content-code"></div>
</div>
<!-- Github Corner Ribbon - to remove (Ribbon created with : http://tholman.com/github-corners/ )-->
<a href="https://github.com/tapsi-pack/api-doc" class="github-corner"
   aria-label="View source on Github" title="View source on Github">
    <svg width="80" height="80" viewBox="0 0 250 250"
         style="z-index:99999; fill:#70B7FD; color:#fff; position: fixed; top: 0; border: 0; right: 0;"
         aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm {
    animation: octocat-wave 560ms ease-in-out
}

@keyframes octocat-wave {
    0%, 100% {
        transform: rotate(0)
    }
    20%, 60% {
        transform: rotate(-25deg)
    }
    40%, 80% {
        transform: rotate(10deg)
    }
}

@media (max-width: 500px) {
    .github-corner:hover .octo-arm {
        animation: none
    }

    .github-corner .octo-arm {
        animation: octocat-wave 560ms ease-in-out
    }
}

@media only screen and (max-width: 680px) {
    .github-corner > svg {
        right: auto !important;
        left: 0 !important;
        transform: rotate(270deg) !important;
    }
}</style>
<!-- END Github Corner Ribbon - to remove -->
<script src="js/script.js"></script>
</body>
</html>